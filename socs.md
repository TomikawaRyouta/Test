# TaskBoard API システム仕様書

## 1. 概要

本仕様書は、TaskBoard APIシステムの設計内容、機能、データ構造について説明するものである。

TaskBoard APIは、タスク管理を目的としたRESTful APIシステムである。ASP.NET Core 8.0をベースとし、F#関数型プログラミング言語で実装されている。本システムは、タスクの作成、取得、更新、削除といった基本的なCRUD操作に加え、ステータス・タグ・期限日による高度なフィルタリング機能、並び替え機能、ページネーション機能を提供する。

本システムの主な利用者は、タスク管理を必要とする業務アプリケーションやWebサービスであり、HTTP通信を通じてタスク情報の管理を行うことができる。業務現場においては、プロジェクト管理ツールやチーム内のタスク共有システムとして利用されることを想定している。

データの永続化には、JSONファイル形式を採用しており、インメモリ上で高速に動作しつつ、定期的および終了時にファイルへ保存することで、サーバー再起動後もデータの継続性を保証する。また、タスク情報をCSV形式でエクスポートする機能も備えており、Excel等の表計算ソフトウェアでの分析や報告資料作成にも対応している。

SwaggerによるAPI仕様ドキュメントの自動生成機能を実装しているが、F#の判別共用体型との互換性に一部制約があるため、実際のAPI動作検証にはcurlコマンドやテストスクリプトの利用を推奨している。


## 2. 前提条件

本システムの動作および理解のために必要な前提条件を以下に示す。

### 動作環境

本システムは、.NET 8.0 SDK以上がインストールされた環境で動作する。対応OSは、Windows、macOS、Linuxであり、ASP.NET Core 8.0が動作する環境であれば実行可能である。

開発および実行には、dotnet CLIツールを使用する。

### 使用技術

本システムは、以下の技術およびフレームワークを使用して実装されている。

プログラミング言語としてF#を採用しており、関数型プログラミングのパラダイムに基づいた設計となっている。F#の特徴である不変データ構造、判別共用体、パターンマッチング、オプション型などを積極的に活用している。

WebフレームワークとしてASP.NET Core 8.0を使用しており、コントローラーベースのREST APIを提供する。

データのシリアライズ・デシリアライズには、System.Text.Jsonを使用している。JSON形式でのHTTPリクエスト・レスポンス、およびファイルへの保存・読み込みに利用している。

APIドキュメント生成には、Swashbuckle.AspNetCoreを使用しており、OpenAPI仕様に基づいたSwagger UIを提供する。

### サーバーポート

デフォルトでは、HTTPSは5001番ポート、HTTPは5000番ポートで起動する。これらはappsettings.jsonまたは起動オプションで変更可能である。

### データ永続化

データは、プロジェクトルートディレクトリ配下の「data」フォルダ内に、「tasks.json」というファイル名で保存される。ファイルが存在しない場合は、アプリケーション起動時に自動的にディレクトリとファイルが作成される。

JSONファイルの文字エンコーディングは、BOM無しのUTF-8形式である。

### スレッドセーフティ

本システムは、複数のHTTPリクエストを並行処理するため、インメモリストレージ層においてロックベースの排他制御を実装している。

### 依存性注入

ASP.NET Coreの依存性注入機能を使用しており、すべてのサービスクラスはDIコンテナを通じてコントローラーに注入される。


## 3. 用語定義

本仕様書内で使用する重要な用語について、以下に定義を示す。

### タスク（Task）

本システムで管理する作業単位を「タスク」と呼ぶ。各タスクは、タイトル、説明、ステータス、タグ、期限日といった属性を持つ。

### タスクアイテム（TaskItem）

システム内部でタスクを表現するデータモデル。すべての必須項目と任意項目を含む完全な形式のタスク情報を保持する。

### DTO（Data Transfer Object）

クライアントとサーバー間でデータをやり取りする際に使用する転送用データ構造。本システムでは、タスク作成用のCreateTaskDtoと、タスク更新用のUpdateTaskDtoを定義している。

### ステータス（Status）

タスクの進行状況を表す列挙値。NotStarted（未着手）、InProgress（進行中）、Completed（完了）、OnHold（保留中）の4種類が存在する。

### タグ（Tag）

タスクに付与する分類用のラベル。文字列のリストとして複数設定可能であり、検索やフィルタリングに使用される。

### フィルタリング

複数のタスクの中から、特定の条件に合致するタスクのみを抽出する機能。ステータス、タグ、キーワード、期限日範囲による絞り込みが可能である。

### ページネーション

大量のタスクデータを一度に取得するのではなく、指定された件数ごとに分割して取得する機能。ページ番号と1ページあたりの件数を指定して使用する。

### ソート（並び替え）

タスクの一覧を、指定された項目（タイトル、ステータス、期限日、作成日時、更新日時）に基づいて昇順または降順に並び替える機能。

### インメモリストレージ

タスクデータをメモリ上の辞書型データ構造で保持するストレージ方式。高速なアクセスが可能だが、アプリケーション終了時にはデータが消失するため、定期的にファイルへ保存する仕組みと組み合わせて使用する。

### JSON永続化

タスクデータをJSON形式のテキストファイルとして保存・読み込みする仕組み。アプリケーション起動時にファイルから復元し、定期的（1分ごと）およびアプリケーション終了時にファイルへ保存する。

### CRUD操作

データ管理における基本的な4つの操作を指す。Create（作成）、Read（取得）、Update（更新）、Delete（削除）の頭文字をとった略語である。

### RESTful API

HTTPプロトコルを利用し、リソース（本システムではタスク）に対して標準的なHTTPメソッド（GET、POST、PUT、DELETE）を用いて操作を行うAPI設計スタイル。

### Swagger / OpenAPI

REST APIの仕様を記述するための標準規格、およびその仕様に基づいてAPI仕様書を自動生成・表示するツール。本システムでは、開発環境でSwagger UIが利用可能である。


## 4. システム構成

TaskBoard APIシステムは、レイヤードアーキテクチャに基づいて設計されており、責務の分離を明確にしている。以下、各層の役割と構成について説明する。

### 全体構成

本システムは、大きく分けて以下の5つの層から構成される。

コントローラー層は、HTTPリクエストを受け取り、適切なサービスを呼び出し、HTTPレスポンスを返す役割を担う。入力パラメータのバリデーションやHTTPステータスコードの制御もこの層で行う。

サービス層は、ビジネスロジックを実装する層である。タスクの作成、更新、削除といった業務処理の流れを制御し、ストレージ層へのアクセスを仲介する。

ストレージ層は、タスクデータをメモリ上で保持し、CRUD操作、フィルタリング、ソート、ページネーションといったデータアクセスロジックを提供する。

モデル層は、タスクに関するデータ構造を定義する。タスクそのものの構造、DTO、フィルタオプション、ページネーション結果などが定義されている。

永続化層は、メモリ上のデータをファイルシステムに保存・読み込みする機能を提供する。バックグラウンドサービスとして動作し、定期的な自動保存を実行する。

### ディレクトリ構成

プロジェクトは以下のディレクトリ構造で構成されている。

Controllersディレクトリ配下には、TaskController.fsとTagController.fsの2つのコントローラーが配置されている。TaskControllerはタスクのCRUD操作とCSVエクスポート機能を提供し、TagControllerはタグの一覧取得機能を提供する。

Modelsディレクトリ配下には、TaskItem.fsとFilterOptions.fsが配置されている。TaskItem.fsにはタスクのデータモデルとDTO定義が含まれ、FilterOptions.fsにはフィルタリングとページネーションのためのオプション定義が含まれている。

Servicesディレクトリ配下には、TaskService.fsとJsonPersistenceService.fsが配置されている。TaskServiceはタスク管理のビジネスロジックを実装し、JsonPersistenceServiceはJSON形式でのファイル保存・読み込み機能を提供する。

Storageディレクトリ配下には、InMemoryTaskStore.fsが配置されている。このクラスは、メモリ上でタスクデータを保持し、スレッドセーフなアクセスを保証する。

プロジェクトルートには、Program.fsが配置されており、これがアプリケーションのエントリーポイントとなる。ASP.NET Coreの初期設定、DIコンテナへのサービス登録、ミドルウェアの構成などが行われる。

### 依存関係

各層の依存関係は以下の通りである。

コントローラー層はサービス層に依存する。コントローラーはTaskServiceおよびロガーを依存性注入により受け取る。

サービス層はストレージ層に依存する。TaskServiceはInMemoryTaskStoreを依存性注入により受け取る。

永続化層はストレージ層に依存する。JsonPersistenceServiceはInMemoryTaskStoreを依存性注入により受け取り、データの保存と読み込みを行う。

すべての層はモデル層に依存する。各層でTaskItem、CreateTaskDto、UpdateTaskDto、FilterOptions、PaginatedResultといったモデルを参照する。

これらのサービスは、すべてProgram.fsのDI設定においてシングルトンとして登録されており、アプリケーション全体で単一のインスタンスが共有される。

### 外部システム連携

本システムは、現時点では外部システムとの連携は実装されていない。すべてのデータは内部のインメモリストレージとローカルファイルシステムで管理される。

将来的な拡張として、データベースシステムとの連携、外部認証サービスとの統合、Webhookによる他システムへの通知機能などが想定される。


## 5. 機能概要

TaskBoard APIシステムが提供する主な機能を以下に示す。

### タスクのCRUD操作

タスクの作成、取得、更新、削除を行う基本機能。新しいタスクを登録し、既存のタスク情報を参照・変更・削除することができる。

### タスクの一覧取得とフィルタリング

複数のタスクを一覧で取得する際に、ステータス、タグ、キーワード、期限日の範囲によるフィルタリングを適用できる。これにより、特定の条件に合致するタスクのみを効率的に抽出できる。

### タスクの並び替え

タスク一覧を、タイトル、ステータス、期限日、作成日時、更新日時のいずれかの項目で昇順または降順に並び替えることができる。

### ページネーション

大量のタスクが存在する場合に、指定した件数ごとに分割して取得できる。ページ番号と1ページあたりの件数を指定し、全体件数や総ページ数も同時に取得できる。

### タグの一覧取得

システムに登録されているすべてのタスクから、使用されているタグを重複なく抽出し、アルファベット順に並べて一覧表示する。タグによる分類や絞り込みの際に利用される。

### CSV形式でのエクスポート

すべてのタスク情報をCSV形式のテキストファイルとして出力する機能。Excelや表計算ソフトで開くことができ、レポート作成やデータ分析に活用できる。

### JSONファイルへの自動保存

タスクデータを定期的（1分ごと）に自動保存し、アプリケーション終了時にも保存を実行する。これにより、データの損失を防ぐ。

### JSONファイルからの自動読み込み

アプリケーション起動時に、既存のJSONファイルが存在する場合は自動的に読み込み、以前の状態を復元する。

### Swagger UIによるAPI仕様表示

開発環境において、Swagger UIを通じてAPI仕様を視覚的に確認できる。ただし、F#の型システムとの互換性の問題により、一部表示が正しく行われない場合がある。


## 6. 機能詳細

以下、各機能について詳細に説明する。

### 6.1 タスクの作成機能

#### 目的
新しいタスクをシステムに登録する。

#### 処理の流れ
クライアントから、タスクのタイトル、説明、ステータス、タグ、期限日を含むJSON形式のリクエストボディを受け取る。

TaskControllerのCreateTaskメソッドが呼び出され、まずタイトルが空でないことを検証する。タイトルが空の場合は、400 Bad Requestエラーを返して処理を中断する。

検証が成功すると、TaskServiceのCreateTaskメソッドが呼び出される。

TaskServiceでは、現在日時を取得し、新しいGUIDをタスクIDとして生成する。DTOで指定されなかった任意項目には、デフォルト値（ステータスはNotStarted、タグは空リスト）が設定される。作成日時と更新日時には現在日時が設定される。

生成されたTaskItemオブジェクトが、InMemoryTaskStoreのAddメソッドに渡され、メモリ上の辞書に追加される。

作成されたタスクがクライアントに返され、HTTPステータスコード201 Createdと、作成されたリソースの取得URLがLocationヘッダに設定されて返される。

#### 入力情報
CreateTaskDtoオブジェクトがJSONとして送信される。必須項目はTitleのみであり、Description、Status、Tags、DueDateは任意である。

#### 出力結果
作成されたTaskItemオブジェクトがJSONとして返される。自動生成されたID、作成日時、更新日時が含まれる。

#### 正常動作
タイトルが指定されている場合、タスクが正常に作成され、201 Createdが返される。

#### エラー処理
タイトルが空または空白のみの場合、400 Bad Requestが返され、エラーメッセージ「Title is required」が応答される。


### 6.2 タスクのID指定取得機能

#### 目的
指定されたIDに対応する単一のタスクを取得する。

#### 処理の流れ
クライアントから、URLパスパラメータとしてタスクのGUID形式のIDが送信される。

TaskControllerのGetTaskByIdメソッドが呼び出され、TaskServiceのGetTaskByIdメソッドに処理が委譲される。

TaskServiceは、InMemoryTaskStoreのGetByIdメソッドを呼び出し、指定されたIDに対応するタスクを検索する。

ストレージ層では、ロックを取得した後、辞書からIDをキーとしてタスクを取得する。タスクが存在する場合はSome taskを返し、存在しない場合はNoneを返す。

コントローラー層で、戻り値がSomeの場合は200 OKと共にタスク情報を返し、Noneの場合は404 Not Foundを返す。

#### 入力情報
URLパスパラメータとしてGUID形式のタスクID。

#### 出力結果
タスクが存在する場合、TaskItemオブジェクトがJSONとして返される。

#### 正常動作
指定されたIDのタスクが存在する場合、200 OKと共にタスク情報が返される。

#### エラー処理
指定されたIDのタスクが存在しない場合、404 Not Foundが返される。


### 6.3 タスクの一覧取得・フィルタリング・ソート・ページネーション機能

#### 目的
複数のタスクを、条件を指定して検索し、並び替え、ページング処理を行って取得する。

#### 処理の流れ
クライアントから、クエリパラメータとして、status、tag、keyword、dueDateFrom、dueDateTo、sortBy、sortDescending、page、pageSizeが送信される。すべて任意であり、指定されない場合はデフォルト値が使用される。

TaskControllerのGetTasksメソッドで、各クエリパラメータをFilterOptionsオブジェクトに変換する。Null許容型のパラメータは、値が存在する場合のみOption型のSomeに変換される。

FilterOptionsオブジェクトが、TaskServiceのGetTasksメソッドに渡される。

TaskServiceは、InMemoryTaskStoreのFilterSortAndPaginateメソッドを呼び出す。

ストレージ層では、ロックを取得した後、以下の順序で処理が実行される。

まず、すべてのタスクをリストとして取得する。

ステータスによるフィルタリングが指定されている場合、文字列からTaskStatus列挙型への変換を試み、一致するステータスのタスクのみを残す。

タグによるフィルタリングが指定されている場合、タスクのタグリストの中に指定されたタグが含まれるもののみを残す。比較は大文字小文字を区別しない。

キーワードによるフィルタリングが指定されている場合、タスクのタイトルまたは説明に指定されたキーワードが含まれるもののみを残す。比較は大文字小文字を区別しない。

期限日範囲によるフィルタリングが指定されている場合、dueDateFromからdueDateToの範囲内に期限日が含まれるタスクのみを残す。期限日が設定されていないタスクは除外される。

次に、sortByパラメータに基づいて並び替えを行う。Title、Status、DueDate、UpdatedAt、CreatedAtのいずれかが指定可能であり、デフォルトはCreatedAtである。sortDescendingがtrueの場合は降順、falseの場合は昇順に並べる。

全体の件数をカウントし、総ページ数を計算する。

指定されたページ番号とページサイズに基づいて、該当範囲のタスクのみを抽出する。

最終的に、PaginatedResultオブジェクトが生成され、タスクのリスト、全体件数、現在のページ番号、ページサイズ、総ページ数が含まれる。

このオブジェクトがJSON形式でクライアントに返される。

#### 入力情報
クエリパラメータとして、status、tag、keyword、dueDateFrom、dueDateTo、sortBy、sortDescending、page、pageSizeが指定可能。すべて任意。

#### 出力結果
PaginatedResultオブジェクトがJSONとして返される。itemsフィールドにタスクの配列、totalCountに全体件数、pageに現在のページ番号、pageSizeに1ページあたりの件数、totalPagesに総ページ数が含まれる。

#### 正常動作
条件に合致するタスクが存在する場合、指定されたページのタスク一覧が返される。合致するタスクが存在しない場合、空の配列と件数0が返される。

#### エラー処理
本機能では、クライアントからの不正な入力に対して特にエラーを返さず、無効なパラメータは無視されるか、デフォルト値に置き換えられる。


### 6.4 タスクの更新機能

#### 目的
既存のタスクの情報を変更する。

#### 処理の流れ
クライアントから、URLパスパラメータとしてタスクID、リクエストボディとしてUpdateTaskDtoオブジェクトが送信される。

TaskControllerのUpdateTaskメソッドが呼び出され、TaskServiceのUpdateTaskメソッドに処理が委譲される。

TaskServiceでは、まず指定されたIDのタスクをストレージから取得する。タスクが存在しない場合は、Noneを返して処理を終了する。

タスクが存在する場合、既存のタスク情報を元に、DTOで指定されたフィールドのみを更新した新しいTaskItemオブジェクトを生成する。DTOのフィールドがNoneの場合は既存の値がそのまま使用される。更新日時には現在日時が設定される。

生成された更新後のTaskItemオブジェクトが、InMemoryTaskStoreのUpdateメソッドに渡される。

ストレージ層では、ロックを取得した後、指定されたIDのタスクが存在することを確認し、辞書の値を更新する。

更新されたタスクがコントローラーに返され、200 OKと共にクライアントに送信される。

#### 入力情報
URLパスパラメータとしてタスクID。リクエストボディとしてUpdateTaskDtoオブジェクト。すべてのフィールドが任意である。

#### 出力結果
更新後のTaskItemオブジェクトがJSONとして返される。

#### 正常動作
指定されたIDのタスクが存在し、更新が成功した場合、200 OKと更新後のタスク情報が返される。

#### エラー処理
指定されたIDのタスクが存在しない場合、404 Not Foundが返される。


### 6.5 タスクの削除機能

#### 目的
指定されたIDのタスクをシステムから削除する。

#### 処理の流れ
クライアントから、URLパスパラメータとしてタスクIDが送信される。

TaskControllerのDeleteTaskメソッドが呼び出され、TaskServiceのDeleteTaskメソッドに処理が委譲される。

TaskServiceは、InMemoryTaskStoreのDeleteメソッドを呼び出す。

ストレージ層では、ロックを取得した後、辞書からタスクを削除する。削除が成功した場合はtrueを、タスクが存在せず削除できなかった場合はfalseを返す。

コントローラー層で、戻り値がtrueの場合は204 No Contentを返し、falseの場合は404 Not Foundを返す。

#### 入力情報
URLパスパラメータとしてタスクID。

#### 出力結果
成功時はボディなし、失敗時は404エラー。

#### 正常動作
指定されたIDのタスクが存在し、削除が成功した場合、204 No Contentが返される。

#### エラー処理
指定されたIDのタスクが存在しない場合、404 Not Foundが返される。


### 6.6 タグ一覧取得機能

#### 目的
システムに登録されているすべてのタスクから、使用されているタグを重複なく抽出し、一覧表示する。

#### 処理の流れ
TagControllerのGetAllTagsメソッドが呼び出され、TaskServiceのGetAllTagsメソッドに処理が委譲される。

TaskServiceは、InMemoryTaskStoreのGetAllTagsメソッドを呼び出す。

ストレージ層では、ロックを取得した後、すべてのタスクのタグリストを平坦化し、重複を除去し、アルファベット順に並び替えてリストとして返す。

タグのリストがJSON配列としてクライアントに返される。

#### 入力情報
なし。

#### 出力結果
文字列配列として、ユニークなタグのリストがアルファベット順で返される。

#### 正常動作
タグが存在する場合はそのリストが返され、タグが1つも使用されていない場合は空の配列が返される。

#### エラー処理
特にエラー処理はなく、常に200 OKが返される。


### 6.7 CSV形式エクスポート機能

#### 目的
すべてのタスク情報をCSV形式のテキストファイルとして出力する。

#### 処理の流れ
TaskControllerのExportToCsvメソッドが呼び出され、TaskServiceのExportToCsvメソッドに処理が委譲される。

TaskServiceでは、InMemoryTaskStoreからすべてのタスクを取得する。

StringBuilderを使用してCSV形式の文字列を構築する。

まず、ヘッダー行として、「Id,Title,Description,Status,Tags,DueDate,CreatedAt,UpdatedAt」を出力する。

次に、各タスクについて、以下の処理を行う。

タイトル、説明、タグは、カンマ、ダブルクォート、改行を含む場合、ダブルクォートで囲み、内部のダブルクォートはエスケープ処理を行う。

ステータスは、列挙型から文字列に変換する。

タグは、セミコロンで連結して1つの文字列にする。

期限日は、YYYY-MM-DD形式に変換する。期限日が設定されていない場合は空文字列とする。

作成日時と更新日時は、YYYY-MM-DD HH:mm:ss形式に変換する。

すべてのフィールドをカンマで連結して1行とする。

生成されたCSV文字列をBOM無しのUTF-8エンコーディングでバイト配列に変換し、ファイルダウンロードレスポンスとして返す。Content-Typeは「text/csv」、ファイル名は「tasks.csv」が指定される。

#### 入力情報
なし。

#### 出力結果
CSV形式のテキストファイルがダウンロードされる。

#### 正常動作
すべてのタスクがCSV形式で出力され、200 OKと共にファイルが返される。タスクが存在しない場合は、ヘッダー行のみのCSVファイルが返される。

#### エラー処理
特にエラー処理はなく、常に200 OKが返される。


### 6.8 JSONファイルへの保存機能

#### 目的
メモリ上のタスクデータをJSONファイルとして永続化する。

#### 処理の流れ
JsonPersistenceServiceが、IHostedServiceインターフェースを実装しており、アプリケーションのライフサイクルに組み込まれている。

アプリケーション起動時にStartAsyncメソッドが呼び出され、定期保存タイマーが開始される。

タイマーは1分ごとにコールバック関数を実行し、SaveToFileメソッドを呼び出す。

アプリケーション終了時にStopAsyncメソッドが呼び出され、タイマーを停止した後、最後にSaveToFileメソッドを実行する。

SaveToFileメソッドでは、以下の処理が行われる。

まず、データディレクトリが存在しない場合は作成する。

InMemoryTaskStoreからすべてのタスクをリストとして取得する。

JsonSerializerを使用してTaskItemのリストをJSON文字列にシリアライズする。インデントが適用され、読みやすい形式で出力される。

JSON文字列を、BOM無しのUTF-8エンコーディングでファイルに書き込む。ファイルパスは「./data/tasks.json」である。

ログに保存したタスク数とファイルパスを記録する。

例外が発生した場合は、エラーログに記録するが、アプリケーションは継続して動作する。

#### 入力情報
メモリ上のタスクデータ。

#### 出力結果
JSONファイルが作成または上書きされる。

#### 正常動作
定期的に、およびアプリケーション終了時に、自動的にファイルへ保存される。

#### エラー処理
ファイル書き込みエラーが発生した場合、エラーログに記録されるが、アプリケーションは継続動作する。


### 6.9 JSONファイルからの読み込み機能

#### 目的
アプリケーション起動時に、既存のJSONファイルからタスクデータを復元する。

#### 処理の流れ
JsonPersistenceServiceのStartAsyncメソッド内で、LoadFromFileメソッドが呼び出される。

LoadFromFileメソッドでは、以下の処理が行われる。

まず、ファイルパス「./data/tasks.json」が存在するかチェックする。

ファイルが存在する場合、BOM無しのUTF-8エンコーディングでファイルを読み込み、JSON文字列を取得する。

JsonDeserializerを使用してJSON文字列をTaskItemのリストにデシリアライズする。

InMemoryTaskStoreのLoadTasksメソッドを呼び出し、タスクリストを渡す。

ストレージ層では、既存の辞書をクリアした後、読み込んだタスクをすべて辞書に追加する。

ログに読み込んだタスク数とファイルパスを記録する。

ファイルが存在しない場合は、新規起動と判断し、その旨をログに記録する。

例外が発生した場合は、エラーログに記録するが、アプリケーションは空の状態で起動を継続する。

#### 入力情報
JSONファイル「./data/tasks.json」。

#### 出力結果
メモリ上のタスクストアにデータが復元される。

#### 正常動作
アプリケーション起動時に、既存のファイルからタスクデータが自動的に復元される。

#### エラー処理
ファイルが存在しない場合、または読み込みエラーが発生した場合、エラーログに記録され、空の状態で起動される。


## 7. データ仕様

本システムで扱う主なデータ構造について説明する。

### 7.1 TaskItemデータ構造

TaskItemは、システム内部でタスクを表現する完全なデータモデルである。

#### Id
データ型はGUID型である。タスクを一意に識別するための識別子であり、システムが自動生成する。

#### Title
データ型は文字列型である。タスクのタイトルを表す。必須項目であり、空にすることはできない。

#### Description
データ型はオプション型の文字列である。タスクの詳細説明を表す。任意項目であり、Noneの場合は説明なしを意味する。

#### Status
データ型はTaskStatus列挙型である。タスクの進行状況を表す。取りうる値は、NotStarted（未着手）、InProgress（進行中）、Completed（完了）、OnHold（保留中）の4種類である。必須項目であり、デフォルト値はNotStartedである。

#### Tags
データ型は文字列のリスト型である。タスクに付与されたタグの配列を表す。任意項目であり、空のリストも許容される。

#### DueDate
データ型はオプション型のDateTime型である。タスクの期限日を表す。任意項目であり、Noneの場合は期限なしを意味する。

#### CreatedAt
データ型はDateTime型である。タスクが作成された日時を表す。システムが自動的に現在日時を設定する。UTC形式で保存される。

#### UpdatedAt
データ型はDateTime型である。タスクが最後に更新された日時を表す。システムが自動的に現在日時を設定する。UTC形式で保存される。


### 7.2 CreateTaskDtoデータ構造

CreateTaskDtoは、新しいタスクを作成する際にクライアントから送信されるデータ転送オブジェクトである。

#### Title
データ型は文字列型である。必須項目。

#### Description
データ型はオプション型の文字列である。任意項目。

#### Status
データ型はオプション型のTaskStatus列挙型である。任意項目。指定されない場合はNotStartedが使用される。

#### Tags
データ型はオプション型の文字列リストである。任意項目。指定されない場合は空のリストが使用される。

#### DueDate
データ型はオプション型のDateTime型である。任意項目。


### 7.3 UpdateTaskDtoデータ構造

UpdateTaskDtoは、既存のタスクを更新する際にクライアントから送信されるデータ転送オブジェクトである。

すべてのフィールドがオプション型であり、指定されたフィールドのみが更新される。指定されなかったフィールドは既存の値が維持される。

#### Title
データ型はオプション型の文字列である。

#### Description
データ型はオプション型の文字列である。

#### Status
データ型はオプション型のTaskStatus列挙型である。

#### Tags
データ型はオプション型の文字列リストである。

#### DueDate
データ型はオプション型のDateTime型である。


### 7.4 TaskStatus列挙型

TaskStatusは、タスクの進行状況を表す列挙型である。以下の4つの値を持つ。

#### NotStarted
タスクがまだ開始されていない状態を表す。デフォルト値である。

#### InProgress
タスクが現在進行中であることを表す。

#### Completed
タスクが完了したことを表す。

#### OnHold
タスクが一時的に保留されていることを表す。


### 7.5 FilterOptionsデータ構造

FilterOptionsは、タスクの一覧取得時に適用するフィルタリング、ソート、ページネーションの条件を指定するためのデータ構造である。

#### Status
データ型はオプション型の文字列である。フィルタリング対象のステータスを指定する。指定可能な値は、「NotStarted」「InProgress」「Completed」「OnHold」である。大文字小文字は区別しない。

#### Tag
データ型はオプション型の文字列である。フィルタリング対象のタグを指定する。大文字小文字は区別しない。

#### Keyword
データ型はオプション型の文字列である。タイトルまたは説明に含まれるキーワードを指定する。大文字小文字は区別しない。

#### DueDateFrom
データ型はオプション型のDateTime型である。期限日の開始日を指定する。

#### DueDateTo
データ型はオプション型のDateTime型である。期限日の終了日を指定する。

#### SortBy
データ型はオプション型の文字列である。ソート対象のフィールドを指定する。指定可能な値は、「Title」「Status」「DueDate」「CreatedAt」「UpdatedAt」である。大文字小文字は区別しない。デフォルト値は「CreatedAt」である。

#### SortDescending
データ型はブール型である。trueの場合は降順、falseの場合は昇順でソートする。デフォルト値はfalseである。

#### Page
データ型は整数型である。取得するページ番号を指定する。1から始まる。デフォルト値は1である。

#### PageSize
データ型は整数型である。1ページあたりの件数を指定する。デフォルト値は10である。


### 7.6 PaginatedResultデータ構造

PaginatedResultは、ページネーション処理の結果を表すデータ構造である。ジェネリック型であり、任意の型のリストを格納できるが、本システムではTaskItemのリストとして使用される。

#### Items
データ型はジェネリック型のリストである。本システムではTaskItemのリストとして使用される。現在のページに含まれるタスクの配列である。

#### TotalCount
データ型は整数型である。フィルタリング条件に合致するタスクの総数を表す。

#### Page
データ型は整数型である。現在のページ番号を表す。

#### PageSize
データ型は整数型である。1ページあたりの件数を表す。

#### TotalPages
データ型は整数型である。総ページ数を表す。TotalCountをPageSizeで割った値を切り上げた値となる。


### 7.7 JSONファイル形式

タスクデータは、TaskItemのリストをJSON形式でシリアライズしたテキストファイルとして保存される。

ファイルパスは「./data/tasks.json」であり、プロジェクトルートからの相対パスである。

文字エンコーディングは、BOM無しのUTF-8である。

JSON形式は、インデント付きで整形されており、人間が読みやすい形式となっている。

TaskStatus列挙型は、文字列として保存される。「NotStarted」「InProgress」「Completed」「OnHold」のいずれかの値となる。

DateTime型は、ISO 8601形式の文字列として保存される。

オプション型は、値が存在する場合はその値が、存在しない場合はnullがJSON出力される。

リスト型は、JSON配列として出力される。


### 7.8 CSV出力形式

CSV出力では、以下のカラム構成でデータが出力される。

ヘッダー行は、「Id,Title,Description,Status,Tags,DueDate,CreatedAt,UpdatedAt」である。

Idは、GUID形式の文字列として出力される。

TitleとDescriptionは、カンマ、ダブルクォート、改行を含む場合、ダブルクォートで囲まれ、内部のダブルクォートは2重化されてエスケープされる。

Statusは、列挙型の名前が文字列として出力される。

Tagsは、セミコロン区切りで連結された文字列として出力される。複数のタグがある場合、「tag1;tag2;tag3」のような形式となる。

DueDateは、YYYY-MM-DD形式の文字列として出力される。期限日が設定されていない場合は空文字列となる。

CreatedAtとUpdatedAtは、YYYY-MM-DD HH:mm:ss形式の文字列として出力される。

文字エンコーディングは、BOM無しのUTF-8である。

改行コードは、環境によって異なるが、通常はLFまたはCRLFである。


---

以上が、TaskBoard APIシステムの仕様書である。本システムは、F#とASP.NET Coreを用いたモダンなWebAPI実装であり、関数型プログラミングのパラダイムを活用しつつ、実用的なタスク管理機能を提供している。
